"use strict";var wcmpAfmLibrary=function(o){return{datePickerSelect:function(t){var e=o(t).is(".sale_price_dates_from")?"minDate":"maxDate",a="minDate"===e?o(t).closest(".sale_price_dates_fields").find(".sale_price_dates_to"):o(t).closest(".sale_price_dates_fields").find(".sale_price_dates_from"),i=o(t).datepicker("getDate");o(a).datepicker("option",e,i),o(t).change()},wcEnhancedSelectInit:function(){try{o(":input.wc-enhanced-select, :input.chosen_select").filter(":not(.enhanced)").each(function(){var t={minimumResultsForSearch:10,allowClear:!!o(this).data("allow_clear"),placeholder:o(this).data("placeholder")};o(this).selectWoo(t).addClass("enhanced")}),o(":input.wc-product-search").filter(":not(.enhanced)").each(function(){var t={allowClear:!!o(this).data("allow_clear"),placeholder:o(this).data("placeholder"),minimumInputLength:o(this).data("minimum_input_length")?o(this).data("minimum_input_length"):"3",escapeMarkup:function(t){return t},ajax:{url:wcmp_advance_product_params.ajax_url,dataType:"json",delay:250,data:function(t){return{term:t.term,action:o(this).data("action")||"woocommerce_json_search_products_and_variations",security:wcmp_advance_product_params.search_products_nonce,exclude:o(this).data("exclude"),include:o(this).data("include"),limit:o(this).data("limit")}},processResults:function(t){var a=[];return t&&o.each(t,function(t,e){a.push({id:t,text:e})}),{results:a}},cache:!0}};if(o(this).selectWoo(t).addClass("enhanced"),o(this).data("sortable")){var a=o(this),e=o(this).next(".select2-container").find("ul.select2-selection__rendered");e.sortable({placeholder:"ui-state-highlight select2-selection__choice",forcePlaceholderSize:!0,items:"li:not(.select2-search__field)",tolerance:"pointer",stop:function(){o(e.find(".select2-selection__choice").get().reverse()).each(function(){var t=o(this).data("data").id,e=a.find('option[value="'+t+'"]')[0];a.prepend(e)})}})}else o(this).prop("multiple")&&o(this).on("change",function(){var t=o(this).children();t.sort(function(t,e){var a=t.text.toLowerCase(),i=e.text.toLowerCase();return i<a?1:a<i?-1:0}),o(this).html(t)})})}catch(t){window.console.log(t)}},wcEnhancedSelectClose:function(){try{o("html").on("click",function(t){this===t.target&&o(".wc-enhanced-select, :input.wc-product-search").filter(".select2-hidden-accessible").selectWoo("close")})}catch(t){window.console.log(t)}},qtip:function(){o(".img_tip").each(function(){o(this).qtip({content:o(this).attr("data-desc"),position:{my:"top center",at:"bottom center",viewport:o(window)},show:{event:"mouseover",solo:!0},hide:{inactive:6e3,fixed:!0},style:{classes:"qtip-dark qtip-shadow qtip-rounded qtip-dc-css",width:200}})})}}}(jQuery),wcmpAfmProductEditor=function(u){var a={productType:u("select#product-type").val(),manageStock:u("input#_manage_stock").is(":checked")},t=null,e=null,i=null;return{getState:function(t){return a.hasOwnProperty(t)?a[t]:""},setState:function(t,e){return!(!a.hasOwnProperty(t)||!e)&&(a[t]=e,!0)},init:function(){u("#woocommerce-product-data").on("change","select#product-type",this.productTypeChanged.bind(this)).on("change","input#_downloadable, input#_virtual",this.updateTabsDisplay.bind(this)).on("click",".sale_schedule",this.showSalePriceDates).on("click",".cancel_sale_schedule",this.hideSalePriceDates).on("change","input#_manage_stock",this.stockManagementPreferenceChanged.bind(this)),u(".add-product-single").on("click",".notice-wrapper button.notice-dismiss",this.dismissNotice),u("#wcmp-edit-product-form").on("click","#wcmp_afm_product_submit, #wcmp_afm_product_draft",this.saveProduct.bind(this)),u("#wcmp-edit-product-form").on("change",'ul.taxonomy-widget input[name^="tax_input"]',this.taxInputChanged.bind(this)),t=this.mediaController(),e=this.downloadsController(),i=this.attributeController(),this.setupEnvironment()},mediaController:function(){var i=null,e=null,r=u("#product_image_gallery");return{init:function(){u(".featured-img").on("click",".upload_image_button:not(.remove)",this.addFeaturedImage).on("click",".upload_image_button.remove",this.removeFeaturedImage),u("#product_images_container").on("click",".add_product_images a",this.addGalleryImages).on("click",".product_images a.delete",this.removeGalleryImage),this.initGalleryImagesSort()},addFeaturedImage:function(t){var e=u(this),a=e.closest(".upload_image");t.preventDefault(),i||(i=wp.media.frames.featured_image=wp.media({title:e.data("title"),button:{text:e.data("button")},states:[new wp.media.controller.Library({title:e.data("title"),filterable:"all"})]})).on("select",function(){var t=i.state().get("selection").first().toJSON(),e=t.sizes&&t.sizes.medium?t.sizes.medium.url:t.url;u(".upload_image_id",a).val(t.id).change(),a.find(".upload_image_button").addClass("remove"),a.find("img").eq(0).attr("src",e)}),i.open()},removeFeaturedImage:function(t){t.preventDefault();var e=u(this).closest(".upload_image");u(".upload_image_id",e).val("").change(),e.find("img").eq(0).attr("src",wcmp_advance_product_params.woocommerce_placeholder_img_src),e.find(".upload_image_button").removeClass("remove")},addGalleryImages:function(t){var i=u(this),o=u("#product_images_container").find("ul.product_images");t.preventDefault(),e||(e=wp.media.frames.product_gallery=wp.media({title:i.data("choose"),button:{text:i.data("update")},states:[new wp.media.controller.Library({title:i.data("choose"),filterable:"all",multiple:!0})]})).on("select",function(){var t=e.state().get("selection"),a=r.val();t.map(function(t){if((t=t.toJSON()).id){a=a?a+","+t.id:t.id;var e=t.sizes&&t.sizes.thumbnail?t.sizes.thumbnail.url:t.url;o.append('<li class="image" data-attachment_id="'+t.id+'"><img src="'+e+'" /><ul class="actions"><li><a href="#" class="delete" title="'+i.data("delete")+'">'+i.data("text")+"</a></li></ul></li>")}}),r.val(a)}),e.open()},removeGalleryImage:function(){u(this).closest("li.image").remove();var e="";return u("#product_images_container").find("ul li.image").css("cursor","default").each(function(){var t=u(this).attr("data-attachment_id");e=e+t+","}),r.val(e),!1},initGalleryImagesSort:function(){u("#product_images_container").find("ul.product_images").sortable({items:"li.image",cursor:"move",scrollSensitivity:40,forcePlaceholderSize:!0,forceHelperSize:!1,helper:"clone",opacity:.65,placeholder:"product-image-gallery-placeholder",start:function(t,e){e.item.css("background-color","#f6f6f6")},stop:function(t,e){e.item.removeAttr("style")},update:function(){var e="";u("#product_images_container").find("ul li.image").css("cursor","default").each(function(){var t=u(this).attr("data-attachment_id");e=e+t+","}),r.val(e)}})}}},downloadsController:function(){var i,o;return{init:function(){u("#woocommerce-product-data").on("click",".downloadable_files a.insert",this.insertDownloadableFiles).on("click",".downloadable_files a.delete",this.deleteDownloadableFiles).on("click",".downloadable_files a.upload_file_button",this.fileUploaded).on("downloadable_file_fields_inserted",this.sortDownloadableFiles)},insertDownloadableFiles:function(){return u(this).closest(".downloadable_files").find("tbody").append(u(this).data("row")),!1},deleteDownloadableFiles:function(){return u(this).closest("tr").remove(),!1},fileUploaded:function(t){var e=u(this);if(o=e.closest("tr").find("td.file_url input"),t.preventDefault(),i)i.open();else{var a=[new wp.media.controller.Library({library:wp.media.query(),multiple:!0,title:e.data("choose"),priority:20,filterable:"uploaded"})];(i=wp.media.frames.downloadable_file=wp.media({title:e.data("choose"),library:{type:""},button:{text:e.data("update")},multiple:!0,states:a})).on("select",function(){var e="";i.state().get("selection").map(function(t){(t=t.toJSON()).url&&(e=t.url)}),o.val(e).change()}),i.on("ready",function(){i.uploader.options.uploader.params={type:"downloadable_product"}}),i.open()}},sortDownloadableFiles:function(){u(".downloadable_files tbody").sortable({items:"tr",cursor:"move",axis:"y",handle:"span.sortable-icon",scrollSensitivity:40,forcePlaceholderSize:!0,helper:"clone",opacity:.65,placeholder:"downloadable-files-sortable-placeholder",start:function(t,e){e.item.css("background-color","#f6f6f6")},stop:function(t,e){e.item.removeAttr("style")}})}}},setupEnvironment:function(){u("select#product-type").change(),u("input#_manage_stock").change(),wcmpAfmLibrary.wcEnhancedSelectInit(),wcmpAfmLibrary.wcEnhancedSelectClose(),wcmpAfmLibrary.qtip(),t.init(),e.init(),i.init(),this.salePriceDateFieldInit(u("#woocommerce-product-data")),u("#woocommerce-product-data").trigger("downloadable_file_fields_inserted"),u(".multiselect.product_tag").select2({tags:wcmp_advance_product_params.add_tags,tokenSeparators:[","],placeholder:u(this).data("placeholder")}).on("change",function(){var a=u(this).find('[data-select2-tag="true"]');if(a.length){var t={action:"wcmp_product_tag_add",new_tag:a.val()};u.ajax({type:"POST",url:wcmp_advance_product_params.ajax_url,data:t,success:function(t){if(t.status){var e=t.tag?t.tag.term_id:a.val();a.replaceWith('<option selected value="'+e+'">'+a.val()+"</option>")}else""!=t.message&&(u(".woocommerce-error,woocommerce-message").remove(),u("#wcmp-afm-add-product").prepend('<div class="woocommerce-error" tabindex="-1">'+t.message+"</div>"),u(".woocommerce-error").focus()),u('.multiselect.product_tag option[value="'+a.val()+'"]').remove()}})}}),u("#product_data_tabs").afmTabInit()},salePriceDateFieldInit:function(t){u(".sale_price_dates_fields",t).each(function(){var t=u(this),e=!1,a=t.closest("div.form-group-row");t.find("input").datepicker({defaultDate:"",dateFormat:"yy-mm-dd",numberOfMonths:1,showButtonPanel:!0,onSelect:function(){wcmpAfmLibrary.datePickerSelect(u(this))}}).on("change",function(){if(!u(this).datepicker("getDate")){var t=u(this).is(".sale_price_dates_from")?"minDate":"maxDate",e="minDate"===t?u(this).closest(".sale_price_dates_fields").find(".sale_price_dates_to"):u(this).closest(".sale_price_dates_fields").find(".sale_price_dates_from");u(e).datepicker("option",t,null)}return!1}),t.find("input").each(function(){""!==u(this).val()&&(e=!0),wcmpAfmLibrary.datePickerSelect(u(this))}),e?(a.find(".sale_schedule").hide(),a.find(".sale_price_dates_fields").show()):(a.find(".sale_schedule").show(),a.find(".sale_price_dates_fields").hide())})},productTypeChanged:function(){var t=u("select#product-type").val();this.setState("productType",t),"variable"===t?(u("input#_manage_stock").change(),u("input#_downloadable").prop("checked",!1),u("input#_virtual").removeAttr("checked")):"grouped"===t?(u("input#_downloadable").prop("checked",!1),u("input#_virtual").removeAttr("checked")):"external"===t&&(u("input#_downloadable").prop("checked",!1),u("input#_virtual").removeAttr("checked")),u("#woocommerce-product-data").trigger("afm-product-type-changed"),this.updateTabsDisplay(),u("ul#product_data_tabs li:visible").eq(0).find("a").tab("show")},updateTabsDisplay:function(){var t=this.getState("productType"),e=u("input#_virtual:checked").length,a=u("input#_downloadable:checked").length,i=".hide_if_downloadable, .hide_if_virtual",o=".show_if_downloadable, .show_if_virtual",r=JSON.parse(wcmp_advance_product_params.default_product_types),n=JSON.parse(wcmp_advance_product_params.product_types);u.extend(n,r),u.each(n,function(t,e){i=i+", .hide_if_"+t,o=o+", .show_if_"+t}),u(i).show(),u(o).hide(),a&&u(".show_if_downloadable").show(),e&&u(".show_if_virtual").show(),u(".show_if_"+t).show(),a&&u(".hide_if_downloadable").hide(),e&&u(".hide_if_virtual").hide(),u(".hide_if_"+t).hide(),u("input#_manage_stock").change(),u(".tab-pane").each(function(){var t=u(this).find(".row-padding > div");if(0!==t.length&&t.filter(function(){return"none"===u(this).css("display")}).length===t.length){var e=u(this).prop("id");u("#product_data_tabs").find('li a[href="#'+e+'"]').parent().hide()}}),u("#product_data_tabs").trigger("tab-display-updated")},showSalePriceDates:function(){var t=u(this).closest("div.form-group-row");return u(this).hide(),t.find(".cancel_sale_schedule").show(),t.find(".sale_price_dates_fields").show(),!1},hideSalePriceDates:function(){var t=u(this).closest("div.form-group-row");return u(this).hide(),t.find(".sale_schedule").show(),t.find(".sale_price_dates_fields").hide(),t.find(".sale_price_dates_fields").find("input").val(""),!1},stockManagementPreferenceChanged:function(){var t=this.getState("productType"),e=u("input#_manage_stock").is(":checked");this.setState("manageStock",e),e?(u("div.stock_fields:not( .hide_if_"+t+" )").show(),u("div.stock_status_field").hide()):(u("div.stock_fields").hide(),u("div.stock_status_field:not( .hide_if_"+t+" )").show())},attributeController:function(){var l=this;return{init:function(){var t=u(".product_attributes").find(".woocommerce_attribute").get();u(t).each(function(t,e){u(e).is(".taxonomy")&&u("select.attribute_taxonomy").find('option[value="'+u(e).data("taxonomy")+'"]').attr("disabled","disabled")}),wcmp_advance_product_params.custom_attribute||this.customAttributeCapCheck(),this.initSortableComponent(),u("#product_attributes_data").on("change","input.attribute_name",this.changeCustomAttributeName).on("click","button.select_all_attributes",this.selectAllAttributes).on("click","button.select_no_attributes",this.removeAllAttributes).on("click","button.add_attribute",this.addAttribute.bind(this)).on("click","a.remove_row",this.removeAttribute.bind(this)).on("click",".save_attributes",this.saveAttribute.bind(this)).on("click",".expand_all",this.expandAllAttributes).on("click",".close_all",this.closeAllAttributes)},customAttributeCapCheck:function(){var t=u("select.attribute_taxonomy").children(":not([disabled=disabled])").first().val();t?u("select.attribute_taxonomy").val(t):u("button.add_attribute").attr("disabled","disabled")},initSortableComponent:function(){var a=this,t={items:".woocommerce_attribute",cursor:"move",axis:"y",handle:".variation-title",scrollSensitivity:40,forcePlaceholderSize:!0,helper:"clone",opacity:.65,placeholder:"wcmp-metabox-sortable-placeholder",start:function(t,e){e.item.css("background-color","#f6f6f6")},stop:function(t,e){e.item.removeAttr("style"),a.updateRowIndices()}};u(".product_attributes").sortable(t)},changeCustomAttributeName:function(){u(this).closest(".woocommerce_attribute").find("strong.attribute_name").text(u(this).val())},selectAllAttributes:function(){return u(this).closest("td").find("select option").attr("selected","selected"),u(this).closest("td").find("select").change(),!1},removeAllAttributes:function(){return u(this).closest("td").find("select option").removeAttr("selected"),u(this).closest("td").find("select").change(),!1},updateRowIndices:function(){u(".product_attributes .woocommerce_attribute").each(function(t,e){u(".attribute_position",e).val(parseInt(u(e).index(".product_attributes .woocommerce_attribute"),10))})},addAttribute:function(t){var e=this,a=u(".product_attributes .woocommerce_attribute").get(),i=0;0<a.length&&(i=a.reduce(function(t,e){var a=parseInt(u(e).find(".woocommerce_attribute_data").attr("id").replace("attribute_",""),10);return isNaN(a)||a<t?t:a},0),++i);var o=u("select.attribute_taxonomy").val();if(o||"1"==wcmp_advance_product_params.custom_attribute){var r=u("#product_attributes_data"),n=r.find(".product_attributes"),c=l.getState("productType"),s={action:"wcmp_edit_product_attribute",taxonomy:o,i:i,security:wcmp_advance_product_params.add_attribute_nonce};r.block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),u.post(wcmp_advance_product_params.ajax_url,s,function(t){"-1"!=t&&(n.append(t),"variable"!==c&&n.find(".enable_variation").hide(),wcmpAfmLibrary.wcEnhancedSelectInit(),wcmpAfmLibrary.qtip(),e.updateRowIndices(),n.find(".woocommerce_attribute").last().find(".variation-title").click(),u("#product_attributes_data").trigger("attribute_added")),r.unblock()})}if(o)if(u("select.attribute_taxonomy").find('option[value="'+o+'"]').attr("disabled","disabled"),1==wcmp_advance_product_params.custom_attribute)u("select.attribute_taxonomy").val("");else{var d=u("select.attribute_taxonomy").children(":not([disabled=disabled])").first().val();d?u("select.attribute_taxonomy").val(d):u("button.add_attribute").attr("disabled","disabled")}return!1},removeAttribute:function(t){if(window.confirm(wcmp_advance_product_params.remove_attribute)){var e=u(t.target).closest(".woocommerce_attribute");e.is(".taxonomy")&&u("select.attribute_taxonomy").find('option[value="'+e.data("taxonomy")+'"]').removeAttr("disabled"),e.remove(),this.updateRowIndices()}return!1},saveAttribute:function(t){var e=u("#woocommerce-product-data");e.block({message:null,overlayCSS:{background:"#fff",opacity:.6}});var a={post_id:wcmp_advance_product_params.product_id,product_type:l.getState("productType"),data:u(".product_attributes").find("input, select, textarea").serialize(),action:"wcmp_product_save_attributes",security:wcmp_advance_product_params.save_attributes_nonce};u.post(wcmp_advance_product_params.ajax_url,a,function(){var t=window.location.toString();t=t.replace(/(?:\/#?|\/\d+\/?)?$/,"/"+wcmp_advance_product_params.product_id+"/"),e.unblock(),e.trigger("wcmp_after_save_attribute_triggered")})},expandAllAttributes:function(){return u(this).closest("#product_attributes_data").find(".wcmp-metabox-wrapper > .wcmp-metabox-content").collapse("show"),!1},closeAllAttributes:function(){return u(this).closest("#product_attributes_data").find(".wcmp-metabox-wrapper > .wcmp-metabox-content").collapse("hide"),!1}}},variationController:function(){var o=this,i=null,r=null,n=null;return{init:function(){(i=this.variationActionsController()).init(),(r=this.variationAjaxController()).init(),this.variationMediaController().init(),(n=this.variationPaginationController()).init()},variationActionsController:function(){return{init:function(){u("#variable_product_options").on("change","input.variable_is_downloadable",this.variableIsDownloadable).on("change","input.variable_is_virtual",this.variableIsVirtual).on("change","input.variable_manage_stock",this.variableManageStock).on("click",".woocommerce_variation span.sort.sortable-icon",this.setMenuOrder).on("click",".variation-title select, .variation-title .remove_row",this.stopToggle).on("click",".expand_all",this.expandAllVariations).on("click",".close_all",this.closeAllVariations).on("reload",this.reload),u("input.variable_is_downloadable, input.variable_is_virtual, input.variable_manage_stock").change(),u("#woocommerce-product-data").on("woocommerce_variations_loaded",this.variationsLoaded),u(document.body).on("woocommerce_variations_added",this.variationAdded)},initSortableComponent:function(){var t={items:".woocommerce_variation",cursor:"move",axis:"y",handle:".variation-title",scrollSensitivity:40,forcePlaceholderSize:!0,helper:"clone",opacity:.65,placeholder:"variation-sortable-placeholder",start:function(t,e){e.item.css("background-color","#f6f6f6")},stop:function(t,e){e.item.removeAttr("style"),i.variationRowIndexes()}};u(".woocommerce_variations").sortable(t)},expandAllVariations:function(){return u(this).closest("#variable_product_options").find(".wcmp-metabox-wrapper > .wcmp-metabox-content").collapse("show"),!1},closeAllVariations:function(){return u(this).closest("#variable_product_options").find(".wcmp-metabox-wrapper > .wcmp-metabox-content").collapse("hide"),!1},reload:function(){r.loadVariations(1),n.setPaginav(0)},variableIsDownloadable:function(){u(this).closest(".woocommerce_variable_attributes").find(".show_if_variation_downloadable").hide(),u(this).is(":checked")&&u(this).closest(".woocommerce_variable_attributes").find(".show_if_variation_downloadable").show()},variableIsVirtual:function(){u(this).closest(".woocommerce_variable_attributes").find(".hide_if_variation_virtual").show(),u(this).is(":checked")&&u(this).closest(".woocommerce_variable_attributes").find(".hide_if_variation_virtual").hide()},variableManageStock:function(){u(this).closest(".woocommerce_variable_attributes").find(".show_if_variation_manage_stock").hide(),u(this).closest(".woocommerce_variable_attributes").find(".hide_if_variation_manage_stock").show(),u(this).is(":checked")&&(u(this).closest(".woocommerce_variable_attributes").find(".show_if_variation_manage_stock").show(),u(this).closest(".woocommerce_variable_attributes").find(".hide_if_variation_manage_stock").hide())},stopToggle:function(t){t.stopPropagation()},variationsLoaded:function(t,e){e=e||!1;var a=u("#woocommerce-product-data");e||(u("input.variable_is_downloadable, input.variable_is_virtual, input.variable_manage_stock",a).change(),u(".woocommerce_variation",a).each(function(t,e){var a=u(e),i=u(".sale_price_dates_from",a).val(),o=u(".sale_price_dates_to",a).val();""===i&&""===o||u("a.sale_schedule",a).click()}),u(".woocommerce_variations .variation-needs-update",a).removeClass("variation-needs-update"),u("button.cancel-variation-changes, button.save-variation-changes",a).attr("disabled","disabled")),o.salePriceDateFieldInit(a),wcmpAfmLibrary.wcEnhancedSelectInit(),wcmpAfmLibrary.qtip(),i.initSortableComponent(),u("#woocommerce-product-data").trigger("downloadable_file_fields_inserted")},variationAdded:function(t,e){1===e&&i.variationsLoaded(null,!0)},setMenuOrder:function(t){t.preventDefault();var e=u(this).closest(".woocommerce_variation").find(".variation_menu_order"),a=window.prompt(wcmp_advance_product_params.i18n_enter_menu_order,e.val()),i=parseInt(a,10);return isNaN(i)||(e.val(i).change(),r.saveVariations()),!1},variationRowIndexes:function(){var t=u("#variable_product_options").find(".woocommerce_variations"),e=parseInt(t.attr("data-page"),10),a=parseInt((e-1)*wcmp_advance_product_params.variations_per_page,10);u(".woocommerce_variations .woocommerce_variation").each(function(t,e){u(".variation_menu_order",e).val(parseInt(u(e).index(".woocommerce_variations .woocommerce_variation"),10)+1+a).change()})}}},variationAjaxController:function(){return{init:function(){u("li.variations_tab a").on("click",this.initialLoad),u("#variable_product_options").on("click","button.save-variation-changes",this.saveVariations).on("click","button.cancel-variation-changes",this.cancelVariations).on("click",".remove_variation",this.removeVariation),u(document.body).on("change","#variable_product_options .woocommerce_variations :input",this.inputChanged).on("change",".variations-defaults select",this.defaultsChanged),u("form#wcmp-afm-add-product").on("submit",this.saveOnSubmit),u(".collapsable-component-wrapper").on("click","a.do_variation_action",this.doVariationAction)},checkForChanges:function(){var t=u("#variable_product_options").find(".woocommerce_variations .variation-needs-update");if(0<t.length){if(!window.confirm(wcmp_advance_product_params.i18n_edited_variations))return t.removeClass("variation-needs-update"),!1;this.saveChanges()}return!0},block:function(){u("#woocommerce-product-data").block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},unblock:function(){u("#woocommerce-product-data").unblock()},initialLoad:function(){0===u("#variable_product_options").find(".woocommerce_variations .woocommerce_variation").length&&n.goToPage()},loadVariations:function(e,t){e=e||1,t=t||wcmp_advance_product_params.variations_per_page;var a=u("#variable_product_options").find(".woocommerce_variations");r.block(),u.ajax({url:wcmp_advance_product_params.ajax_url,data:{action:"wcmp_afm_load_variations",security:wcmp_advance_product_params.load_variations_nonce,product_id:wcmp_advance_product_params.product_id,attributes:a.data("attributes"),page:e,per_page:t},type:"POST",success:function(t){a.empty().append(t).attr("data-page",e),u("#woocommerce-product-data").trigger("woocommerce_variations_loaded"),r.unblock()}})},getVariationsFields:function(t){var i=u(":input",t).serializeJSON();return u(".variations-defaults select").each(function(t,e){var a=u(e);i[a.attr("name")]=a.val()}),i},saveChanges:function(e){var t=u("#variable_product_options").find(".woocommerce_variations"),a=u(".variation-needs-update",t),i={};0<a.length&&(r.block(),(i=this.getVariationsFields(a)).action="woocommerce_save_variations",i.security=wcmp_advance_product_params.save_variations_nonce,i.product_id=wcmp_advance_product_params.product_id,i["product-type"]=o.getState("productType"),u.ajax({url:wcmp_advance_product_params.ajax_url,data:i,type:"POST",success:function(t){a.removeClass("variation-needs-update"),u("button.cancel-variation-changes, button.save-variation-changes").attr("disabled","disabled"),u("#woocommerce-product-data").trigger("woocommerce_variations_saved"),"function"==typeof e&&e(t),r.unblock()}}))},saveVariations:function(){return u("#variable_product_options").trigger("woocommerce_variations_save_variations_button"),r.saveChanges(function(t){var e=u("#variable_product_options").find(".woocommerce_variations"),a=e.attr("data-page");u("#variable_product_options").find("#woocommerce_errors").remove(),t&&e.before(t),u(".variations-defaults select").each(function(){u(this).attr("data-current",u(this).val())}),n.goToPage(a)}),!1},saveOnSubmit:function(t){0<u("#variable_product_options").find(".woocommerce_variations .variation-needs-update").length&&(t.preventDefault(),u("#variable_product_options").trigger("woocommerce_variations_save_variations_on_submit"),r.saveChanges(r.saveOnSubmitDone))},saveOnSubmitDone:function(){u("form#post").submit()},cancelVariations:function(){var t=parseInt(u("#variable_product_options").find(".woocommerce_variations").attr("data-page"),10);return u("#variable_product_options").find(".woocommerce_variations .variation-needs-update").removeClass("variation-needs-update"),u(".variations-defaults select").each(function(){u(this).val(u(this).attr("data-current"))}),n.goToPage(t),!1},addVariation:function(){this.block();var t={action:"wcmp_afm_add_variation",post_id:wcmp_advance_product_params.product_id,loop:u(".woocommerce_variation").length,security:wcmp_advance_product_params.add_variation_nonce};return u.post(wcmp_advance_product_params.ajax_url,t,function(t){var e=u(t);e.addClass("variation-needs-update"),u("#variable_product_options").find(".woocommerce_variations").prepend(e),u("button.cancel-variation-changes, button.save-variation-changes").removeAttr("disabled"),u("#variable_product_options").trigger("woocommerce_variations_added",1),r.unblock()}),!1},removeVariation:function(){if(r.checkForChanges(),window.confirm(wcmp_advance_product_params.i18n_remove_variation)){var t=u(this).attr("rel"),e=[],a={action:"woocommerce_remove_variations"};r.block(),0<t?(e.push(t),a.variation_ids=e,a.security=wcmp_advance_product_params.delete_variations_nonce,u.post(wcmp_advance_product_params.ajax_url,a,function(){var t=u("#variable_product_options").find(".woocommerce_variations"),e=parseInt(t.attr("data-page"),10),a=Math.ceil((parseInt(t.attr("data-total"),10)-1)/wcmp_advance_product_params.variations_per_page),i=1;u("#woocommerce-product-data").trigger("woocommerce_variations_removed"),e===a||e<=a?i=e:a<e&&0!==a&&(i=a),n.goToPage(i,-1)})):r.unblock()}return!1},linkAllVariations:function(){if(this.checkForChanges(),window.confirm(wcmp_advance_product_params.i18n_link_all_variations)){this.block();var t={action:"woocommerce_link_all_variations",post_id:wcmp_advance_product_params.product_id,security:wcmp_advance_product_params.link_variation_nonce};u.post(wcmp_advance_product_params.ajax_url,t,function(t){var e=parseInt(t,10);1===e?window.alert(e+" "+wcmp_advance_product_params.i18n_variation_added):0===e||1<e?window.alert(e+" "+wcmp_advance_product_params.i18n_variations_added):window.alert(wcmp_advance_product_params.i18n_no_variations_added),0<e?(n.goToPage(1,e),u("#variable_product_options").trigger("woocommerce_variations_added",e)):r.unblock()})}return!1},inputChanged:function(){u(this).closest(".woocommerce_variation").addClass("variation-needs-update"),u("button.cancel-variation-changes, button.save-variation-changes").removeAttr("disabled"),u("#variable_product_options").trigger("woocommerce_variations_input_changed")},defaultsChanged:function(){u(this).closest("#variable_product_options").find(".woocommerce_variation:first").addClass("variation-needs-update"),u("button.cancel-variation-changes, button.save-variation-changes").removeAttr("disabled"),u("#variable_product_options").trigger("woocommerce_variations_defaults_changed")},doVariationAction:function(){var t,e=u("select.variation_actions").val(),a={},i=0;switch(e){case"add_variation":return void r.addVariation();case"link_all_variations":return void r.linkAllVariations();case"delete_all":window.confirm(wcmp_advance_product_params.i18n_delete_all_variations)&&window.confirm(wcmp_advance_product_params.i18n_last_warning)&&(a.allowed=!0,i=-1*parseInt(u("#variable_product_options").find(".woocommerce_variations").attr("data-total"),10));break;case"variable_regular_price_increase":case"variable_regular_price_decrease":case"variable_sale_price_increase":case"variable_sale_price_decrease":if(null===(t=window.prompt(wcmp_advance_product_params.i18n_enter_a_value_fixed_or_percent)))return;0<=t.indexOf("%")?a.value=accounting.unformat(t.replace(/\%/,""),wcmp_advance_product_params.mon_decimal_point)+"%":a.value=accounting.unformat(t,wcmp_advance_product_params.mon_decimal_point);break;case"variable_regular_price":case"variable_sale_price":case"variable_stock":case"variable_weight":case"variable_length":case"variable_width":case"variable_height":case"variable_download_limit":case"variable_download_expiry":if(null===(t=window.prompt(wcmp_advance_product_params.i18n_enter_a_value)))return;a.value=t;break;case"variable_sale_schedule":if(a.date_from=window.prompt(wcmp_advance_product_params.i18n_scheduled_sale_start),a.date_to=window.prompt(wcmp_advance_product_params.i18n_scheduled_sale_end),null===a.date_from&&(a.date_from=!1),null===a.date_to&&(a.date_to=!1),!1===a.date_to&&!1===a.date_from)return;break;default:u("select.variation_actions").trigger(e),a=u("select.variation_actions").triggerHandler(e+"_ajax_data",a)}"delete_all"===e&&a.allowed?u("#variable_product_options").find(".variation-needs-update").removeClass("variation-needs-update"):r.checkForChanges(),r.block(),u.ajax({url:wcmp_advance_product_params.ajax_url,data:{action:"woocommerce_bulk_edit_variations",security:wcmp_advance_product_params.bulk_edit_variations_nonce,product_id:wcmp_advance_product_params.product_id,product_type:o.getState("productType"),bulk_action:e,data:a},type:"POST",success:function(){n.goToPage(1,i)}})}}},variationMediaController:function(){var o=null,r=null,n=null,c=wp.media.model.settings.post.id;return{init:function(){u("#variable_product_options").on("click",".upload_image_button",this.addImage),u("a.add_media").on("click",this.restoreWPMediaPostId)},addImage:function(t){var e=u(this),a=e.attr("rel"),i=e.closest(".upload_image");if(n=i,r=a,t.preventDefault(),e.is(".remove"))u(".upload_image_id",n).val("").change(),n.find("img").eq(0).attr("src",wcmp_advance_product_params.woocommerce_placeholder_img_src),n.find(".upload_image_button").removeClass("remove");else{if(o)return o.uploader.uploader.param("post_id",r),void o.open();wp.media.model.settings.post.id=r,(o=wp.media.frames.variable_image=wp.media({title:wcmp_advance_product_params.i18n_choose_image,button:{text:wcmp_advance_product_params.i18n_set_image},states:[new wp.media.controller.Library({title:wcmp_advance_product_params.i18n_choose_image,filterable:"all"})]})).on("select",function(){var t=o.state().get("selection").first().toJSON(),e=t.sizes&&t.sizes.thumbnail?t.sizes.thumbnail.url:t.url;u(".upload_image_id",n).val(t.id).change(),n.find(".upload_image_button").addClass("remove"),n.find("img").eq(0).attr("src",e),wp.media.model.settings.post.id=c}),o.open()}},restoreWPMediaPostId:function(){wp.media.model.settings.post.id=c}}},variationPaginationController:function(){return{init:function(){u(document.body).on("woocommerce_variations_added",this.updateSingleQuantity).on("change",".variations-pagenav .page-selector",this.pageSelector).on("click",".variations-pagenav .first-page",this.firstPage).on("click",".variations-pagenav .prev-page",this.prevPage).on("click",".variations-pagenav .next-page",this.nextPage).on("click",".variations-pagenav .last-page",this.lastPage)},updateVariationsCount:function(t){var e=u("#variable_product_options").find(".woocommerce_variations"),a=parseInt(e.attr("data-total"),10)+t,i=u(".variations-pagenav .displaying-num");return e.attr("data-total",a),1===a?i.text(wcmp_advance_product_params.i18n_variation_count_single.replace("%qty%",a)):i.text(wcmp_advance_product_params.i18n_variation_count_plural.replace("%qty%",a)),a},updateSingleQuantity:function(t,e){if(1===e){var a=u(".variations-pagenav");n.updateVariationsCount(e),a.is(":hidden")&&(u("option, optgroup",".variation_actions").show(),u(".variation_actions").val("add_variation"),u("#variable_product_options").find(".toolbar").show(),a.show(),u(".pagination-links",a).hide())}},setPaginav:function(t){var e=u("#variable_product_options").find(".woocommerce_variations"),a=this.updateVariationsCount(t),i=u("#variable_product_options").find(".toolbar"),o=u(".variation_actions"),r=u(".variations-pagenav"),n=u(".pagination-links",r),c=Math.ceil(a/wcmp_advance_product_params.variations_per_page),s="";e.attr("data-total_pages",c),u(".total-pages",r).text(c);for(var d=1;d<=c;d++)s+='<option value="'+d+'">'+d+"</option>";u(".page-selector",r).empty().html(s),0===a?(i.not(".toolbar-top, .toolbar-buttons").hide(),r.hide(),u("option, optgroup",o).hide(),u(".variation_actions").val("add_variation"),u('option[data-global="true"]',o).show()):(i.show(),r.show(),u("option, optgroup",o).show(),u(".variation_actions").val("add_variation"),1===c?n.hide():n.show())},checkIsEnabled:function(t){return!u(t).hasClass("disabled")},changeClasses:function(t,e){var a=u(".variations-pagenav .first-page"),i=u(".variations-pagenav .prev-page"),o=u(".variations-pagenav .next-page"),r=u(".variations-pagenav .last-page");1===t?(a.addClass("disabled"),i.addClass("disabled")):(a.removeClass("disabled"),i.removeClass("disabled")),e===t?(o.addClass("disabled"),r.addClass("disabled")):(o.removeClass("disabled"),r.removeClass("disabled"))},setPage:function(t){u(".variations-pagenav .page-selector").val(t).first().change()},goToPage:function(t,e){t=t||1,e=e||0,this.setPaginav(e),this.setPage(t)},pageSelector:function(){var t=parseInt(u(this).val(),10),e=u("#variable_product_options").find(".woocommerce_variations");u(".variations-pagenav .page-selector").val(t),r.checkForChanges(),n.changeClasses(t,parseInt(e.attr("data-total_pages"),10)),r.loadVariations(t)},firstPage:function(){return n.checkIsEnabled(this)&&n.setPage(1),!1},prevPage:function(){if(n.checkIsEnabled(this)){var t=u("#variable_product_options").find(".woocommerce_variations"),e=parseInt(t.attr("data-page"),10)-1,a=0<e?e:1;n.setPage(a)}return!1},nextPage:function(){if(n.checkIsEnabled(this)){var t=u("#variable_product_options").find(".woocommerce_variations"),e=parseInt(t.attr("data-total_pages"),10),a=parseInt(t.attr("data-page"),10)+1,i=a<=e?a:e;n.setPage(i)}return!1},lastPage:function(){if(n.checkIsEnabled(this)){var t=u("#variable_product_options").find(".woocommerce_variations").attr("data-total_pages");n.setPage(t)}return!1}}}}},dismissNotice:function(){u(this).parent().remove()},getTinymceContent:function(t){return u("#wp-"+t+"-wrap").hasClass("tmce-active")&&"undefined"!=typeof tinyMCE&&tinyMCE.get(t)?tinyMCE.get(t).getContent():u("textarea#"+t).val()},saveProduct:function(t){u("#additional-errors").remove(),u("form#wcmp-edit-product-form").trigger("before_product_save");var e="wcmp_afm_product_submit"===t.target.id?"publish":"wcmp_afm_product_draft"===t.target.id?"draft":"",a={post_title:{get:function(){return u("#post_title").val()},error_message:"Product title is required"},short_description:{get:function(){return this.getTinymceContent("product_excerpt")}.bind(this),error_message:"Short description is required"},coa:{get:function(){return 0<u("[data-coa-id]").length||u("#product_coa").val()},error_message:"Certificate of Authenticity is required"},image:{get:function(){return u("#featured_img").val()},error_message:"Product image is required"},price:{get:function(){return u("#_regular_price").val()},error_message:"Price is required"},weight:{get:function(){return u("#_weight").val()},error_message:"Weight is required"},est_shipping_time:{get:function(){return u("#est_shipping_time").val()},error_message:"Estimated shipping time is required"},cbd_content:{get:function(){return u("#cbd_content").val()},error_message:"CBD content is required"}},i=[];if("publish"===e)i=Object.keys(a).map(function(t){var e=a[t];return!e.get()&&e.error_message}).filter(function(t){return t});if(u('input:hidden[name="status"]').val(e),u("textarea#product_description").val(this.getTinymceContent("product_description")),u("textarea#product_excerpt").val(this.getTinymceContent("product_excerpt")),i.length){var o='<ul class="woocommerce-error" role="alert" id="additional-errors">'+i.map(function(t){return"<li>"+t+"</li>"}).join("")+"</ul>";return u(".notice-wrapper").append(o),u(".notice-wrapper").get(0).scrollIntoView({behavior:"smooth",block:"end",inline:"nearest"}),!1}return!0},taxInputChanged:function(t){u(this).is(":checked")||u(this).prop("checked",!1)}}}(jQuery);jQuery(function(){wcmpAfmProductEditor.init()});